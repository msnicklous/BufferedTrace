<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BufferedTrace: BufferedTrace - a simple Arduino library for debugging</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">BufferedTrace
   </div>
   <div id="projectbrief">Library for buffered tracing</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('index.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">BufferedTrace - a simple Arduino library for debugging </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__c_1_2dev_2_arduino_2tries_2libraries_2_buffered_trace_2readme"></a></p>
<p>by <a href="https://github.com/msnicklous/">Martin Scott Nicklous</a> | <a href="https://github.com/msnicklous/BufferedTrace/">Github Project Page</a></p>
<p>Released under the MIT License</p>
<hr  />
 <h1 class="doxsection"><a class="anchor" id="autotoc_md6"></a>
Overview</h1>
<p>A common debugging technique is sending trace information to a console <br  />
 through the serial interface. Sometimes you need to collect information from time-critical portions of your code and send it to the console later in order to minimize trace impact on program timing. This library helps you do that.</p>
<p>The Serial object (and probably most other serial stream implementations) has a buffer, and when you use Serial.println(), you write data into that buffer. The underlying Serial code will immediately start sending data over the serial interface. In general, this will cause interrupts to fire, which can interfere with your time-critical code. When you use BufferedTrace, transmission won't begin until your time-critical code has completed.</p>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md8"></a>
Arduino Code</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md9"></a>
Getting Started</h2>
<p>To begin, include the BufferedTrace Library at the top of your sketch.</p>
<div class="fragment"><div class="line">#include &lt;BufferedTrace.h&gt;</div>
</div><!-- fragment --><p>This will provide a global instance of the BufferedTrace class called Trace for your convenience. By default, BufferedTrace uses the standard Serial stream for output, but a method is provided for using a different stream if you need to. BufferedTrace needs to be initialized during the setup() function of your sketch, and since it uses Serial (or other stream), that needs to be initialized as well:</p>
<div class="fragment"><div class="line">setup() {</div>
<div class="line">  ...</div>
<div class="line">  Serial.begin(115200);</div>
<div class="line">  Trace.init();</div>
<div class="line">  ...</div>
<div class="line">}</div>
</div><!-- fragment --><p>If the Trace.init() function is not called, no tracing will be performed. Calls to other trace methods such as Trace.trace() and Trace.itrace() will be ignored.</p>
<p>BufferedTrace uses a default buffer size of 80 characters, but if you want a different size, you can specify that in the init call:</p>
<div class="fragment"><div class="line">setup() {</div>
<div class="line">  ...</div>
<div class="line">  Serial.begin(115200);</div>
<div class="line">  Trace.init(120);</div>
<div class="line">  ...</div>
<div class="line">}</div>
</div><!-- fragment --><p>As a general tip, you usually want to keep your tracing brief, both to conserve memory as well as for timing reasons. It takes about 7 milliseconds to transfer 80 bytes, and for some applications, that delay can be significant.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md10"></a>
Buffered Tracing</h2>
<p>To used buffered tracing, you bracket the Trace.trace() calls between the Trace.open() and Trace.close() calls. Trace.open() resets the buffer and starts collecting trace data. Trace.close() causes all trace data collected by the Trace.trace() calls to be written to the serial interface. I usually put Trace.open() at the top of the loop() block and Trace.close() at the end.</p>
<div class="fragment"><div class="line">void loop() {</div>
<div class="line">  static int ref0 = analogRead(A0);</div>
<div class="line">  long start = millis();</div>
<div class="line">  </div>
<div class="line">  Trace.open();</div>
<div class="line"> </div>
<div class="line">  if (digitalRead(SWITCH_PIN)) {</div>
<div class="line">    ref0 = analogRead(A0);</div>
<div class="line">    Trace.trace(&quot;ref&quot;, ref0);</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  // ... do interesting stuff ...</div>
<div class="line">  </div>
<div class="line">  long t = millis() - start;</div>
<div class="line">  Trace.trace(&quot;time&quot;, t);</div>
<div class="line"> </div>
<div class="line">  Trace.close();</div>
<div class="line">}</div>
</div><!-- fragment --><p> If you call Trace.trace() either before calling Trace.open() or after calling Trace.close(), any data will be ignored.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md11"></a>
Immediate Tracing</h2>
<p>The Trace.itrace() function will immediately write a string to the serial interface without regards for contents of the buffer.</p>
<div class="fragment"><div class="line">void loop() {</div>
<div class="line">  static int ref0 = analogRead(A0);</div>
<div class="line">  long start = millis();</div>
<div class="line">  </div>
<div class="line">  Trace.open();</div>
<div class="line"> </div>
<div class="line">  if (digitalRead(SWITCH_PIN)) {</div>
<div class="line">    Trace.itrace(&quot;button pressed!!&quot;);</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  // ... do interesting stuff ...</div>
<div class="line">  </div>
<div class="line">  long t = millis() - start;</div>
<div class="line">  Trace.trace(&quot;time&quot;, t);</div>
<div class="line"> </div>
<div class="line">  Trace.close();</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
</div><!-- doc-content -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
